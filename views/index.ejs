<!doctype html>
<html lang="ko" data-bs-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>판자 크리틱</title>

    <!-- BootStrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <!--  My Stylesheet  -->
    <link rel="stylesheet" type="text/css" href="/style/r_style.css">

    <!--  JQuery  -->
    <script src="http://code.jquery.com/jquery-latest.js"></script>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand navbar-light fixed-top r-navbar r-bg-primary not-draggable" id="navbar">
        <div class="container-fluid align-text-bottom">
            <a class="navbar-brand" href="/">
                <img src="/img/logo-sm.png" alt="" width="30" height="30" style="margin: 0;"
                    class="d-inline-block align-text-top not-draggable-img"></a>
            <div class="collapse navbar-collapse scroll-horiz scroll-no-bar" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link r-active r-nav-link" aria-current="page" href="#overview">톺아보기</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link r-nav-link" href="#uploads">업로드</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link r-nav-link" href="#promises">약속</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link r-nav-link" href="#assesments">개밥그릇</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div data-bs-spy="scroll" data-bs-target="#navbar" data-bs-smooth-scroll="true">

        <div class="container mt-7 d-flex justify-content-center" style="max-width: 640px;" id="overview">
            <img class="img-fluid" src="/img/cover.png">
        </div>

        <!-- Overview -->
        <div class="container mt-7" style="max-width: 640px;" id="overview">
            <h1>톺아보기</h1>
            <div class="card-neumorph p-3 mt-4">
                <h2>실시간 총점</h2>
                <span style="font-size: 8em;">
                    <%= totalScore.toFixed(1) %>점
                </span>
                <br>
                <span>점수 보정치 <%= calibrate %>점이 적용되고 있습니다.</span>
                <br>
                <br>
                <div class="progress-stacked">
                    <div class="progress" role="progressbar" aria-label="Segment one"
                        aria-valuenow="<%= uploadScore / 3.0 %>" aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= uploadScore / 3.0 %>%">
                        <div class="progress-bar"></div>
                    </div>
                    <div class="progress" role="progressbar" aria-label="Segment two"
                        aria-valuenow="<%= promiseScore / 3.0 %>" aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= promiseScore / 3.0 %>%">
                        <div class="progress-bar bg-success"></div>
                    </div>
                    <div class="progress" role="progressbar" aria-label="Segment three"
                        aria-valuenow="<%= likeScore / 3.0 %>" aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= likeScore / 3.0 %>%">
                        <div class="progress-bar bg-info"></div>
                    </div>
                </div>
                <ul class="list-group mt-3">
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="ms-2 me-auto">이달 업로드</div>
                        </div>
                        <span class="badge bg-primary rounded-pill">
                            <%= uploads.length %>
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="ms-2 me-auto">약속</div>
                        </div>
                        <span class="badge bg-primary rounded-pill">
                            <%= promiseDone[0].count + promiseHalf[0].count %> / <%= promiseDone[0].count +
                                    promiseHalf[0].count + promiseFail[0].count %>
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="ms-2 me-auto">개밥그릇 평가</div>
                        </div>
                        <span class="badge bg-primary rounded-pill">
                            <% if (likeScore>= 80) { %>
                                압도적으로 긍정적
                                <% } else if (likeScore>= 60) { %>
                                    긍정적
                                    <% } else if (likeScore>= 40) { %>
                                        복합적
                                        <% } else if (likeScore>= 20) { %>
                                            부정적
                                            <% } else { %>
                                                압도적으로 부정적
                                                <% } %>
                        </span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Uploads -->
        <div class="container mt-7" style="max-width: 640px;" id="uploads">
            <h1>영상 업로드</h1>
            <div class="card-neumorph p-3 mt-4">
                <h2>이달 업로드</h2>
                <span style="font-size: 6em;">
                    <% uploads.length %>
                </span>
                <div class="progress" role="progressbar" aria-label="Info example" aria-valuenow="<%= uploadScore %>"
                    aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar bg-info" style="width: <%= uploadScore %>%"></div>
                </div>

                <ul class="list-group mt-3">
                    <% for (var i=0; i < uploads.length; i++) { %>
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="ms-2 me-auto"><a class="btn-link" href="<%= uploads[i].url %>">
                                        <%= uploads[i].title %>
                                    </a></div>
                            </div>
                        </li>
                        <% } %>
                </ul>
            </div>
        </div>

        <!-- Promise -->
        <div class="container mt-7" style="max-width: 640px;" id="promises">
            <h1>약속</h1>
            <div class="card-neumorph p-3 mt-4">
                <h2>지킨 약속</h2>
                <span style="font-size: 6em;">
                    <%= promiseDone[0].count + promiseHalf[0].count %>
                </span>
                <div class="progress-stacked">
                    <div class="progress" role="progressbar" aria-label="Segment one"
                        aria-valuenow="<%= promiseDone == 0 ? 0 : promiseDone.count / (promiseDone[0].count + promiseHalf[0].count + promiseFail[0].count) * 100 %>"
                        aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= promiseDone == 0 ? 0 : promiseDone.count / (promiseDone[0].count + promiseHalf[0].count + promiseFail[0].count) * 100 %>%">
                        <div class="progress-bar"></div>
                    </div>
                    <div class="progress" role="progressbar" aria-label="Segment one"
                        aria-valuenow="<%= promiseDone == 0 ? 0 : promiseHalf.count / (promiseDone[0].count + promiseHalf[0].count + promiseFail[0].count) * 100 %>"
                        aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= promiseDone == 0 ? 0 : promiseHalf.count / (promiseDone[0].count + promiseHalf[0].count + promiseFail[0].count) * 100 %>%">
                        <div class="progress-bar bg-warning"></div>
                    </div>
                    <div class="progress" role="progressbar" aria-label="Segment two"
                        aria-valuenow="<%= promiseDone == 0 ? 0 : promiseFail.count / (promiseDone[0].count + promiseHalf[0].count + promiseFail[0].count) * 100 %>"
                        aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= promiseDone == 0 ? 0 : promiseFail.count / (promiseDone[0].count + promiseHalf[0].count + promiseFail[0].count) * 100 %>%">
                        <div class="progress-bar bg-danger"></div>
                    </div>
                </div>
                <br>
                <span class="mt-3">최근 약속</span>
                <ul class="list-group mt-1">
                    <% for (var i=0; i < promiseTop.length; i++) { %>
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="ms-2 me-auto">
                                    <div class="fw-bold"><%= promiseTop[i].promise %></div>
                                    <% if (promiseTop[i].report && promiseTop[i].report !== "") { %>
                                        <%= promiseTop[i].report %>
                                    <% } %>
                                </div>
                            </div>
                            <span class="badge bg-primary rounded-pill">
                                <% switch (promiseTop[i].status) { case 0: %>안지킴
                                    <% break; case 1: %>반만 지킴
                                        <% break; case 2: %>지킴
                                            <% break; } %>
                            </span>
                        </li>
                        <% } %>
                </ul>
            </div>
        </div>

        <!-- Assesment -->
        <div class="container mt-7" style="max-width: 640px;" id="assesments">
            <h1>개밥그릇</h1>
            <div class="card-neumorph p-3 mt-4">
                <h2>좋아요/킹받아요</h2>
                <span style="font-size: 6em;">
                    <% if (likeScore>= 80) { %>
                        압도적으로<br>긍정적
                        <% } else if (likeScore>= 60) { %>
                            긍정적
                            <% } else if (likeScore>= 40) { %>
                                복합적
                                <% } else if (likeScore>= 20) { %>
                                    부정적
                                    <% } else { %>
                                        압도적으로<br>부정적
                                        <% } %>
                </span>
                <div class="progress-stacked">
                    <div class="progress" role="progressbar" aria-label="Segment one"
                        aria-valuenow="<%= parseFloat(likes[0].count) / (likes[0].count + sads[0].count) * 100 %>"
                        aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= parseFloat(likes[0].count) / (likes[0].count + sads[0].count) * 100 %>%">
                        <div class="progress-bar">좋아요 <%= likes[0].count %></div>
                    </div>
                    <div class="progress" role="progressbar" aria-label="Segment one"
                        aria-valuenow="<%= parseFloat(sads[0].count) / (likes[0].count + sads[0].count) * 100 %>"
                        aria-valuemin="0" aria-valuemax="100"
                        style="width: <%= parseFloat(sads[0].count) / (likes[0].count + sads[0].count) * 100 %>%">
                        <div class="progress-bar bg-warning">킹받아요 <%= sads[0].count %></div>
                    </div>
                </div>
            </div>

            <div class="card-neumorph p-3 mt-4">
                <h2>투표해주세요!</h2>
                <span>투표는 총점에도 반영되어요!</span>
                <br>
                <span>투표는 취소할 수 없고, 하루에 다섯 번만 누를 수 있어요</span>
                <br>
                <div class="btn-group mt-3" role="group" aria-label="Basic mixed styles example">
                    <a class="btn btn-primary" href="/like">🥰 좋아요</a>
                    <a class="btn btn-warning" href="/sad">🔥 킹받아요</a>
                </div>
            </div>
        </div>
    </div>

    <!--  Footer  -->
    <div class="container footer mt-7">
        
    </div>

    <!-- BootStrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

    <!-- Script -->
    <script type="text/javascript">
        //https://stackoverflow.com/questions/63082529/how-to-properly-introduce-a-light-dark-mode-in-bootstrap
        // Set theme to the user's preferred color scheme
        function updateTheme() {
            const colorMode = window.matchMedia("(prefers-color-scheme: dark)").matches ?
                "dark" :
                "light";
            document.querySelector("html").setAttribute("data-bs-theme", colorMode);
        }

        // Set theme on load
        updateTheme()

        // Update theme when the preferred scheme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme)
    </script>
</body>

</html>